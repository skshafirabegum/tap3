"use strict";var ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kenytChatBubbleJs=function(){var r,s={EVENT_USER_CALL_INCOMING:"user_call_incoming",EVENT_USER_CALL_ACCEPTED:"user_call_accepted",EVENT_USER_CALL_REJECTED:"user_call_rejected",EVENT_USER_CALL_DISCONNECT_SELF:"user_call_disconnect_self",EVENT_USER_CALL_DISCONNECT_SERVER:"user_call_disconnect_server",EVENT_USER_CALL_CONNECTION_ESTABLISHED:"user_call_connection_established",EVENT_USER_CALL_CONNECTION_CLOSED:"user_call_connection_closed",EVENT_USER_CALL_CONNECTION_FAILED:"user_call_connection_failed"};function a(e,t){var n,a=e&&e.lineno||"0",o=e&&e.colno||"0",i="["+(e&&e.filename||"unknown-file")+":"+a+":"+o+"] "+(e&&e.message||"null");n={eventName:"exception",details:{description:i,fatal:t||!1},isException:!0},O(A.ReportGoogleAnalyticsEvent,n),console.debug(new Date+" "+i)}window.dataLayer=window.dataLayer||[];var c={},e="data-unreadcount",d="kenytCallRinger",u="kenytIncomingCall",t=document.kenytRootUrl||"https://www.kenyt.ai";t.includes("kenyt.ai")&&(t+="/botapp");var n,m,g={CALL_RING_SOUND:t+"/ChatbotUI/audio/incoming_call.mp3",TRACKING_URL_PREFIX:t+"/api/tracking/trackactivity?activityId='"},p=document.getElementById("kenytChatBubble"),f=document.getElementById("chatbox-container"),o=!1,i=0<window.location.href.indexOf("ampframe.html"),v=' \n    <div class="kenyt-media-container">\n        <video id="local" autoplay playsinline muted></video>\n        <div class="action-bar w-100">\n            <button class="call-action bg-green" id="call-start" title="Start call"><i class="fas fa-phone rotate-135"></i></button>\n            <button class="call-action bg-green" id="call-accept" title="Accept call"><i class="fas fa-phone"></i></button>\n            <button class="call-action bg-white" id="call-microphone-toggle" data-isenabled="true" title="Toggle microphone"><i class="fas fa-microphone"></i></button>\n            <button class="call-action bg-red" id="call-end" title="End call"><i class="fas fa-phone rotate-225"></i></button>\n            <button class="call-action bg-white" id="call-video-toggle" data-isenabled="true" title="Toggle video"><i class="fas fa-video"></i></button>\n            <button class="call-action bg-white" id="call-camera-toggle" data-isenabled="false" title="Toggle camera"><i class="fas fa-retweet"></i></button>\n            <button class="call-action bg-red" id="call-screenshare-toggle" data-isenabled="false" title="Toggle screen share"><i class="fas fa-desktop"></i></button>\n            <div class="float-right m-2 mr-3">\n                <button class="call-action bg-white" id="call-fullscreen-toggle" data-isfullscreen="false" title="Toggle fullscreen"><i class="fas fa-expand-arrows-alt"></i></button>\n            </div>\n        </div>\n        <video id="remote" autoplay playsinline></video>\n    </div>',y='\n    <div class="incoming-call text-center py-4">\n        <p>\n            <i class="fas fa-phone-volume fa-3x fa-inverse incoming-call-icon text-success"></i> \n            <span class="incoming-call-text ml-2">Incoming Call</span>\n        </p>\n        <div class="incoming-call-action text-left" id="accept-video-call">\n            <button class="call-action bg-green text-white"><span class="fas fa-video"></span></button>\n            <span>Accept</span>\n        </div>\n        <div class="incoming-call-action text-left" id="reject-call">\n            <button class="call-action bg-danger text-white"><span class="fas fa-phone rotate-225"></span></button>\n            <span>Dismiss</span>\n        </div>\n    </div>\n    ',h="kenyt-highlightArea",b='\n        <div class="kenyt-highlightArea"></div>\n    ',C=(document&&document.querySelector(".chatWithUsMessage"),"__kenytsession__"),l=new Date,E=0,L={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:"user"}},S={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:"environment"}},w={iceServers:[{urls:["stun:bn-turn1.xirsys.com"]},{username:"4Ts0wdSOWv7YcYBEli_S3pJfs7xktfm-ZMxmJ8zQxvcQeu0zvMvUFmepCr3i4t8uAAAAAF6lNP9rZW55dGluYw==",credential:"aae708e6-878d-11ea-b80d-9646de0e6ccd",urls:["turn:bn-turn1.xirsys.com:80?transport=udp","turn:bn-turn1.xirsys.com:3478?transport=udp","turn:bn-turn1.xirsys.com:80?transport=tcp","turn:bn-turn1.xirsys.com:3478?transport=tcp","turns:bn-turn1.xirsys.com:443?transport=tcp","turns:bn-turn1.xirsys.com:5349?transport=tcp"]}]},k=4e3,A={UnreadMessage:"kenytUnreadMessage",ChatWindowClose:"kenytChatWindowClose",ChatWindowOpen:"kenytChatWindowOpen",FullScreenImage:"kenytFullScreenImage",NavigateToPage:"kenytNavigateToPage",ToggleFullScreen:"kenytToggleFullscreen",ForceFullHeight:"kenytForceFullHeight",TextColor:"kenytTextColor",IsWindowMinimizedResponse:"kenytIsWindowMinimizedResponse",WindowHover:"kenytWindowHover",GetPageTitle:"kenytPageTitle",GetReferrer:"kenytPageReferrer",Initialize:"kenytInitialize",PageInfoRequest:"kenytPageInfoRequest",PageInfoResponse:"kenytPageInfoResponse",CustomEventDispatch:"kenytCustomEventDispatch",SettingsUpdate:"kenytSettingsUpdate",UpdateChatBubbleColor:"kenytUpdateChatBubbleColor",UpdateBotPosition:"kenytUpdateBotPosition",MediaStreamingCommand:"kenytMediaStreamingCommand",SendMessage:"kenytSendMessage",ReportGoogleAnalyticsEvent:"reportGoogleAnalyticsEvent",OpenRazorpayForm:"kenytOpenRazorpayForm",SubmitRazorpayPayment:"kenytSubmitRazorpayPayment"},T={center:"position-center",left:"position-left",right:"position-right"},_=null,I=function(){var e="__feature_test";try{return window.sessionStorage.setItem(e,e),window.sessionStorage.removeItem(e),!0}catch(e){return!1}}();function R(){n&&window.clearInterval(n),f&&(f.classList.remove("k-hide"),p.classList.add("k-hide")),O(A.IsWindowMinimizedResponse,!1),p.removeEventListener("click",R),p.addEventListener("click",N),p.hasAttribute(e)&&p.removeAttribute(e),U()}function N(){if(document.querySelector("#chatbox-container")&&(f.classList.add("k-hide"),p.classList.remove("k-hide")),O(A.IsWindowMinimizedResponse,!0),o){var e=p.querySelector(".chatWithUsMessage");e&&(e.style.display="none")}p.removeEventListener("click",N),p.addEventListener("click",R),U()}function x(e,t){M(e,+e.getAttribute("current-slide-number")+ +t)}function M(e,t){if(e){var n=e.getElementsByClassName("img-card");t>n.length?t=1:t<1&&(t=n.length);for(var a=0;a<n.length;a++)n[a].style.display="none";n[t-1].style.display="flex",e.setAttribute("current-slide-number",t)}}function P(){f&&f.classList.contains("full-height")&&f.classList.remove("full-height")}function U(){if(i){var e=document.querySelector("#chatbox-container"),t=100,n=100;"none"===e.style.display?n=t=100:e.classList&&(n=e.classList.contains("k-hide")?t=100:e.classList.contains("force-fullscreen")?t=1e3:e.classList.contains("full-height")?(t=370,1e3):D()?(t=370,350):(t=370,470)),t&&100<=t&&n&&100<=n&&window.parent.postMessage({sentinel:"amp",type:"embed-size",width:t,height:n},"*")}}function D(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function O(e,t){var n=document.querySelector("#kenytChatWindow").contentWindow;if(n){var a={type:e,value:t};n.postMessage(a,"*")}else console.warn("[Kenyt.AI] Iframe load error")}function B(){return{PageTitle:document.title,PageUrl:window.location.href,StartTime:l,SessionId:m}}function q(){var e=window.location.search;return e&&(e=e.substring(1)),{SessionId:m,Updated:!1,FirstPageQueryPrm:e,History:[B()]}}function W(e){return e&&"string"==typeof e&&0<e.trim().length}function H(e){var t=null;if(I){var n=window.localStorage.getItem(e);W(n)&&(t=JSON.parse(n))}return t}function z(e,t){I&&W(e)&&t&&window.localStorage.setItem(e,JSON.stringify(t))}function F(e){console.error(e),e&&(e.message=e.message||"",e.message="Handle Error: "+e.message),a(e,!0)}function V(e,t,n){var a={Type:e,Command:t,Data:n},o=JSON.parse(JSON.stringify(a));console.log("Outgoing Signal : ",o),O(A.MediaStreamingCommand,o)}function G(){console.log("closeIncomingCallPopup");var e,t=document.getElementById(u);t&&t.remove(),e=document.getElementById(d),window.setTimeout(function(){e.pause()},0)}function j(e){if(console.log("showCallPopup",e),!document.querySelector(".kenyt-media-container")){var t=te(v);(c=c||{}).endCallButton=t.querySelector("button#call-end"),c.startCallButton=t.querySelector("button#call-start"),c.acceptCallButton=t.querySelector("button#call-accept"),c.localMediaElement=t.querySelector("video#local"),c.remoteMediaElement=t.querySelector("video#remote"),c.showReject=t.querySelector("button#call-reject"),c.startCallButton.addEventListener("click",function(){ae()}),c.endCallButton.addEventListener("click",function(){O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_DISCONNECT_SELF,isException:!1}),ne("Ending call",!0,!1,!1),ue(),V("MediaPlayer","EndCall",""),pe()}),c.acceptCallButton.addEventListener("click",function(){oe()});var n=t.querySelector("#call-fullscreen-toggle"),a=t.querySelector("#call-microphone-toggle"),i=t.querySelector("#call-video-toggle"),l=t.querySelector("#call-screenshare-toggle");navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||l.setAttribute("hidden","true");var r=t.querySelector("#call-camera-toggle");navigator.mediaDevices.enumerateDevices().then(function(e){var t=0;e.forEach(function(e){"videoinput"===e.kind&&t++}),E=t,console.log("number of cameras",E),1<E?Q(r):Z(r)}),console.log(r),!1===c.mediaContraints.video&&(i.classList.remove("bg-white"),i.querySelector("i").classList.remove("fa-video"),i.classList.add("bg-red"),i.querySelector("i").classList.add("fa-video-slash"),i.setAttribute("data-isenabled","false")),n.addEventListener("click",function(){"true"===n.getAttribute("data-isfullscreen")?(t.classList.remove("fullscreen"),n.querySelector("i").classList.remove("fa-compress"),n.querySelector("i").classList.add("fa-expand-arrows-alt"),n.setAttribute("data-isfullscreen","false"),ve(t)):(t.classList.add("fullscreen"),n.querySelector("i").classList.remove("fa-expand-arrows-alt"),n.querySelector("i").classList.add("fa-compress"),n.setAttribute("data-isfullscreen","true"),t.onmousedown=null)}),a.addEventListener("click",function(){"true"===a.getAttribute("data-isenabled")?(a.classList.remove("bg-white"),a.querySelector("i").classList.remove("fa-microphone"),a.classList.add("bg-red"),a.querySelector("i").classList.add("fa-microphone-slash"),a.setAttribute("data-isenabled","false"),c.localUserStream.getAudioTracks().forEach(function(e){return e.enabled=!1})):(a.classList.remove("bg-red"),a.querySelector("i").classList.remove("fa-microphone-slash"),a.classList.add("bg-white"),a.querySelector("i").classList.add("fa-microphone"),a.setAttribute("data-isenabled","true"),c.localUserStream.getAudioTracks().forEach(function(e){return e.enabled=!0}))}),i.addEventListener("click",function(){var e=i.getAttribute("data-isenabled"),t=l.getAttribute("data-isenabled");"true"===e?(i.classList.remove("bg-white"),i.querySelector("i").classList.remove("fa-video"),i.classList.add("bg-red"),i.querySelector("i").classList.add("fa-video-slash"),i.setAttribute("data-isenabled","false"),J(),"true"===t&&K(l)):(i.classList.add("bg-white"),i.querySelector("i").classList.add("fa-video"),i.classList.remove("bg-red"),i.querySelector("i").classList.remove("fa-video-slash"),i.setAttribute("data-isenabled","true"),X(),Y(),fe())}),r.addEventListener("click",function(){var e,t,n=r.getAttribute("data-isenabled"),a=i.getAttribute("data-isenabled"),o=l.getAttribute("data-isenabled");n="true"===n?(r.setAttribute("data-isenabled","false"),"false"):(r.setAttribute("data-isenabled","true"),"true"),e=n,t=o,"true"===a&&"false"===t&&(c.localUserStream.getVideoTracks().forEach(function(e){e.stop()}),c.mediaContraints="true"===e?S:L,navigator.mediaDevices.getUserMedia(c.mediaContraints).then(function(e){e&&ee(e)}).catch(F))}),l.addEventListener("click",function(){var e=i.getAttribute("data-isenabled");"true"===l.getAttribute("data-isenabled")?(l.classList.remove("bg-white"),l.classList.add("bg-red"),l.setAttribute("data-isenabled","false"),Y(),V("MediaPlayer","DisableAgentScreenHighlight",""),"true"===e&&X()):(l.classList.add("bg-white"),l.classList.remove("bg-red"),l.setAttribute("data-isenabled","true"),K(l),J())}),fe(),ne("",!0,!1,!1),document.body.appendChild(t),ve(t)}}function J(){c.localUserStream.getVideoTracks().forEach(function(e){return e.enabled=!1}),Z()}function X(){ee(c.localUserStream),Q()}function Y(){c.localDisplayStream&&(c.localDisplayStream.getTracks().forEach(function(e){return e.stop()}),c.localDisplayStream=null),Q(),fe()}function K(t){navigator.mediaDevices.getDisplayMedia().then(function(e){c.localDisplayStream=e;c.localDisplayStream.oninactive=function(e){return function(e,t){if(console.log("Screen share inactive"),t){var n=t.getAttribute("data-isenabled");"true"===n&&t.click()}}(0,t)},ee(c.localDisplayStream),console.log("Enable Agent Highlight"),V("MediaPlayer","EnableAgentScreenHighlight","")}).catch(function(e){e.message=e.message||"",e.message="Screen Sharing: "+e.message,a(e.message,!1),console.log("Error in displaying media",e);var t=document.getElementById("call-screenshare-toggle"),n=document.getElementById("call-video-toggle").getAttribute("data-isenabled");t.classList.remove("bg-white"),t.classList.add("bg-red"),t.setAttribute("data-isenabled","false"),Y(),"true"===n&&X()}),Z()}function Q(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e||(e=te(v).querySelector("#call-camera-toggle"));1<E&&(console.log("Enabling camera button"),e.removeAttribute("hidden"))}function Z(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e||(e=te(v).querySelector("#call-camera-toggle"));console.log("Disbabling camera button"),e.setAttribute("hidden","true")}function ee(e){e.getVideoTracks().forEach(function(e){return e.enabled=!0}),c.localMediaElement.srcObject=e;for(var t=0;t<c.senders.length;t++){var n=c.senders[t];if(n&&n.track&&"video"===n.track.kind){n.replaceTrack(e.getVideoTracks()[0]);break}}}function te(e){e=e.trim();var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}function ne(e,t,n,a,o){console.log("updateMediaStreamingPopup"),c&&(c.messageBox&&(c.messageBox.innerText=e),c.startCallButton&&(t?(c.startCallButton.disabled=!1,c.startCallButton.classList.remove("k-hide")):(c.startCallButton.disabled=!0,c.startCallButton.classList.add("k-hide"))),c.acceptCallButton&&(n?(c.acceptCallButton.disabled=!1,c.acceptCallButton.classList.remove("k-hide")):(c.acceptCallButton.disabled=!0,c.acceptCallButton.classList.add("k-hide"))),c.endCallButton&&(a?(c.endCallButton.disabled=!1,c.endCallButton.classList.remove("k-hide")):(c.endCallButton.disabled=!0,c.endCallButton.classList.add("k-hide"))))}function ae(){ne("Waiting for agent to accept",!1,!1,!0),V("MediaPlayer","StartCall","")}function oe(){O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_ACCEPTED,isException:!1}),ne("Thanks for accepting, connecting with agent",!1,!1,!0),V("MediaPlayer","AcceptCall","")}function ie(){if(console.log("initializePeerConnection"),!c.peerConnection)try{var e=new RTCPeerConnection(w);e.onicecandidate=le,e.onnegotiationneeded=function(){console.log("creating offer"),e.createOffer().then(de).catch(F)},e.ontrack=re,c.peerConnection=e,O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_CONNECTION_ESTABLISHED,isException:!1})}catch(e){console.log("Failed to initialize RTC Peer connection"),F(e),O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_CONNECTION_FAILED,isException:!1})}}function le(e){(console.log("handleICECandidate"),console.log("icecandidate event: ",e),e.candidate)?V("WebRtc","",{type:"candidate",data:e.candidate}):console.log("End of candidates.")}function re(e){console.log("handleRemoteStreamAdded",e),c.remoteMediaElement&&(c.remoteMediaElement.srcObject=e.streams[0],console.log("Remote stream added to remote media element"),c.remoteMediaElement.autoplay=!0,c.remoteMediaElement.playsInline=!0,e.streams.forEach(function(e){e.onremovetrack=se,console.log("remote track ",e)}))}function se(e){console.log("Remote stream removed. Event: ",e)}function ce(t){console.log("saveMediaAndAddTracks"),c.localMediaElement.srcObject=t,ie(),c.senders||(c.senders=[]),t.getTracks().forEach(function(e){c.senders.push(c.peerConnection.addTrack(e,t)),console.log("local track ",e)})}function de(e){console.log("setLocalAndSendOffer"),c.peerConnection.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),V("WebRtc","",e)}function ue(){if(console.log("stopPeerConnection"),c.peerConnection&&(c.peerConnection.getSenders().forEach(function(e){c.peerConnection.removeTrack(e)}),c.peerConnection.close(),c.peerConnection=null),c.localMediaElement&&me(c.localMediaElement),c.remoteMediaElement&&me(c.remoteMediaElement),ge(c.localUserStream),ge(c.localDisplayStream),ne("Call disconnected",!0,!1,!1),O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_CONNECTION_CLOSED,isException:!1}),r){var e=((new Date).valueOf()-r.valueOf())/1e3;console.log("Call duration in seconds = "+e)}}function me(e){(console.log("stopStreamedVideo"),e&&e.srcObject)&&(e.srcObject.getTracks().forEach(function(e){e.stop()}),e.srcObject=null)}function ge(e){console.log("stopping streams"),e&&e.getTracks().forEach(function(e){return e.stop()})}function pe(){console.log("closeCallPopup");var e=document.querySelector(".kenyt-media-container");e&&e.remove()}function fe(){console.log("Removing highlight area");var e=document.getElementById(h);e&&e.remove()}function ve(t){var n=0,a=0,o=0,i=0;function l(e){(e=e||window.event).preventDefault(),n=o-e.clientX,a=i-e.clientY,o=e.clientX,i=e.clientY,t.style.top=t.offsetTop-a+"px",t.style.left=t.offsetLeft-n+"px"}function r(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=function(e){(e=e||window.event).preventDefault(),o=e.clientX,i=e.clientY,document.onmouseup=r,document.onmousemove=l}}return p&&p.addEventListener("click",R),f&&f.addEventListener("mouseover",function(){O(A.WindowHover)}),window.addEventListener("click",function(){P()}),window.addEventListener("touchstart",function(){P()}),window.addEventListener("message",function(e){if("object"===ye(e.data)&&e.data.type){var t=e.data;if(t.type===A.ChatWindowOpen)R();else if(t.type===A.ChatWindowClose)N();else if(t.type===A.ToggleFullScreen)!function(e){var t=document.querySelector("#chatbox-container");e&&t&&("maximize"===e?t.classList.add("force-fullscreen"):"minimize"===e&&t.classList.remove("force-fullscreen"));U()}(t.value);else if(t.type===A.ForceFullHeight)!function(){f&&!f.classList.contains("force-fullscreen")&&f.classList.add("full-height");U()}();else if(t.type===A.FullScreenImage)!function(l){var e=document.querySelector("body"),r=document.createElement("div");r.classList.add("kenyt-fullscreen-container"),r.setAttribute("current-slide-number",l.currentSlideNumber);var t=document.createElement("div");t.classList.add("next","navigation"),t.addEventListener("click",function(){x(r,1)}),t.textContent="❯";var n=document.createElement("div");n.classList.add("prev","navigation"),n.addEventListener("click",function(){x(r,-1)}),n.textContent="❮";var a=document.createElement("span");a.innerHTML="&times;",a.classList.add("kenyt-popup-close"),a.addEventListener("click",function(){o()}),r.appendChild(n),r.appendChild(t);var s=1;function o(){var e=document.querySelector(".kenyt-fullscreen-container");e&&e.remove(),document.removeEventListener("keyup",i)}l.slides.forEach(function(e){var t=document.createElement("div");t.classList.add("img-card");var n=document.createElement("div");n.classList.add("numberText","text"),n.textContent=s+"/"+l.slides.length;var a=document.createElement("div");a.classList.add("img-container");var o=document.createElement("img");o.src=e.imageUrl;var i=document.createElement("div");i.classList.add("captionText","text"),i.textContent=e.caption,a.appendChild(o),t.appendChild(n),t.appendChild(a),t.appendChild(i),r.appendChild(t),s++}),r.appendChild(a),M(r,l.currentSlideNumber),e.appendChild(r),document.addEventListener("keyup",i),document.activeElement&&document.activeElement.blur();function i(e){27===e.keyCode?o():37===e.keyCode?x(r,-1):39===e.keyCode&&x(r,1)}document.focus()}(t.value);else if(t.type===A.NavigateToPage){var n=t.value;!function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e?t?window.location.href=e:window.open(e,"_blank"):console.warn("[Kenyt.AI] Cannot navigate to page - Invalid URL")}(n.url,n.openInSamePage||!1)}else if(t.type===A.TextColor)p.style.color=t.value||p.style.color;else if(t.type===A.Initialize)m=t.value,function(){var e=H(C);if(e)if(e.SessionId===m){if(e.Updated)return console.debug("Tracking data already sent");e.History||(e.History=[]),e.History.push(B())}else e=q();else e=q();z(C,e)}(),O(A.GetPageTitle,document.title||""),O(A.GetReferrer,document.referrer||"");else if(t.type===A.PageInfoRequest)!function(){var e=H(C);e||(e=q());void 0!==e.History&&0<e.History.length&&O(A.PageInfoResponse,e.History);e.Updated=!0,e.History=[],z(C,e)}();else if(t.type===A.CustomEventDispatch){var a=t.value;if(a){var o=new CustomEvent("kenytEvent",{detail:{eventType:a.EventName||null,data:a.EventData||null},bubbles:!0});document.dispatchEvent(o)}}else if(t.type===A.UpdateChatBubbleColor){if(t.value){var i=p.getElementsByClassName("kprimary-bg");Array.from(i).forEach(function(e){e.style.backgroundColor=t.value}),i=p.getElementsByClassName("kprimary-color"),Array.from(i).forEach(function(e){e.style.color=t.value}),i=p.getElementsByClassName("kprimary-border"),Array.from(i).forEach(function(e){e.style.borderColor=t.value})}}else if(t.type===A.UpdateBotPosition&&t.value){var l=t.value.toLowerCase();T[l]&&(Object.keys(T).forEach(function(e){p.classList.remove(T[e]),f.classList.remove(T[e])}),p.classList.add(T[l]),f.classList.add(T[l]))}else t.type===A.MediaStreamingCommand?function(e){console.log("handleMediaStreamingCommand");var t=JSON.parse(JSON.stringify(e));console.log("Incoming Signal : ",t),"MediaPlayer"===e.Type?(a=e,console.log("handleMediaPlayerCommands",a),console.log("command: "+(a.Command||"<empty>")),"OpenMediaPlayer"===a.Command?(j(a.Data),V("Log","OpenMediaPlayerCommand Executed","")):"CloseMediaPlayer"===a.Command?(function(){console.log("closeCallPopup"),ue();var e=document.querySelector(".kenyt-media-container");e&&e.remove()}(),V("Log","CloseMediaPlayerCommand Executed","")):"StartCall"===a.Command?(j(a.Data),V("Log"," Executed","")):"AcceptCall"===a.Command?V("Log","AcceptCallCommand Executed",""):"EndCall"===a.Command?(ue(),pe(),V("Log","End Call Command Executed","")):"ScreenHighlightStarted"===a.Command?(o=a.Data,console.log("highlighting screen",o),function(e){console.log("Adding highlight area");var t=te(b);if(t.setAttribute("id",h),t&&t.style){var n=window.screen.availHeight,a=window.screen.availWidth,o=n/e.WindowHeight,i=a/e.WindowWidth,l=o*e.Top;e.IsFullScreen||e.Bottom,t.style.left=i*e.Left+"px",t.style.right=i*e.Right+"px",t.style.height=o*e.Height+"px",t.style.width=i*e.Width+"px",t.style.top=l+"px",t.style.X=i*e.X,t.style.Y=o*e.Y,t.style.visibility="visible",document.body.appendChild(t)}}(o)):"ScreenHighlightEnded"===a.Command&&(console.log("highlight screen ended"),fe())):"WebRtc"===e.Type?function(e){if("answer"===e.type)console.log("received answer"),ie(),c.peerConnection&&(console.log("setting remote description"),c.peerConnection.setRemoteDescription(e).then(function(){console.log("remote description set successfully")}).catch(function(){console.log("remote description set failed")}));else if("candidate"===e.type&&(ie(),c.peerConnection)){var t=new RTCIceCandidate({sdpMLineIndex:e.data.sdpMLineIndex,candidate:e.data.candidate});c.peerConnection.addIceCandidate(t)}if("offer"===e.type&&(ie(),c.peerConnection)){navigator.mediaDevices.getUserMedia(c.mediaContraints).then(function(e){c.localUserStream=e}),ce(c.localUserStream),c.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),console.log("creating answer");c.peerConnection.createAnswer({offerToReceiveVideo:!0,offerToReceiveAudio:!0}).then(function(e){console.log("created answer successfully"),c.peerConnection.setLocalDescription(e),V("WebRtc","",e)}).catch(this.handleError),this.state="Connected with user"}}(e.Data):"Broadcast"===e.Type?function(e){if("IncomingCall"===e.Command)!function(){console.log("showIncomingCallPopup");var e=te(y);e.setAttribute("id",u),e.querySelector("#accept-video-call").addEventListener("click",function(){G(),c.mediaContraints=L,j(null),oe(),r=new Date}),e.querySelector("#reject-call").addEventListener("click",function(){G(),ne("Rejected the call with agent",!1,!1,!0),O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_REJECTED,isException:!1}),V("MediaPlayer","RejectCall",""),console.log("Rejected Call")}),document.body.appendChild(e),function(){var e=document.getElementById(d);e||(e=function(){var e=document.createElement("audio");e.setAttribute("preload","auto"),e.setAttribute("autobuffer",""),e.setAttribute("loop",""),e.setAttribute("id",d);var t=document.createElement("source");return t.src=g.CALL_RING_SOUND,e.appendChild(t),document.body.appendChild(e),e}());window.setTimeout(function(){e.currentTime=0,e.play()},0)}()}(),O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_INCOMING,isException:!1});else if("CallAccepted"===e.Command)ne("Call Accepted",!1,!1,!0);else if("InitiateMediaConnection"===e.Command){if(c&&(ie(),c.peerConnection))try{navigator.mediaDevices.getUserMedia(c.mediaContraints).then(function(e){c.localUserStream=e,ce(c.localUserStream)})}catch(e){F(e)}ne("Initiating Connection",!1,!1,!0)}else"CallDisconnected"!==e.Command&&"CallMissed"!==e.Command||(O(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_DISCONNECT_SERVER,isException:!1}),ue(),G(),ne(e.Command,!0,!1,!1),setTimeout((pe(),void V("MediaPlayer","CloseMediaPlayer","")),k))}(e):"UserChat"===e.Type&&"StartCall"===(n=e).Command&&(console.log("User wants to start call from chat"),j(n.data),ae());var n;var a,o}(t.value):t.type===A.OpenRazorpayForm&&function(e){var t=document.getElementById("krazorpay-btn"),n=document.getElementById(e.OrderId);if(n){var a=n.getElementsByTagName("input")[0];a.click()}else{t.innerHTML="";var o=function(a){var e=document.createElement("form");e.setAttribute("id",a.OrderId),e.setAttribute("class","option-pill pointer");var t=document.createElement("script");t.setAttribute("src","https://checkout.razorpay.com/v1/checkout.js"),a.Callback&&a.CallbackUrl?t.setAttribute("data-callback_url",a.CallbackUrl):(t.setAttribute("data-key",a.RazorpayKeyId),t.setAttribute("data-amount",a.Amount),t.setAttribute("data-currency",a.Currency),t.setAttribute("data-order_id",a.OrderId),t.setAttribute("data-buttontext",a.ButtonText),t.setAttribute("data-name",a.Name),t.setAttribute("data-description",a.Description),t.setAttribute("data-prefill.name",a.LeadName),t.setAttribute("data-prefill.email",a.LeadEmail),t.setAttribute("data-prefill.contact",a.LeadPhone),t.setAttribute("data-theme.color",a.FrameColor),e.setAttribute("action","javascript:kenytChatBubbleJs.onRazorpayPaymentSuccess("+a.OrderId+")"));return t.addEventListener("load",function(e){if(a.Callback&&a.CallbackUrl){var t={key:a.RazorpayKeyId,currency:a.Currency,name:a.Name,description:a.Description,order_id:a.OrderId,callback_url:a.CallbackUrl,prefill:{name:a.LeadName,email:a.LeadEmail,contact:a.LeadPhone},theme:{color:a.FrameColor}},n=new Razorpay(t);n.on("payment.failed",function(e){}),n.open()}else this.nextElementSibling.click()}),e.appendChild(t),e.addEventListener("click",function(e){e.stopPropagation()}),e}(e);t.appendChild(o)}}(t.value)}},!1),D()&&"https://www.kenyt.ai/botapp/chatbotui/test.html?botname=13"===window.location.href&&window.visualViewport&&(_=window.visualViewport.height,window.visualViewport.addEventListener("resize",function(){var e=window.visualViewport.height,t=_-e;if(150<Math.abs(t)&&D()){var n=Math.max(t,0);console.log("Detected keyboard height:",n),0===n?f.style.removeProperty("height"):f.style.cssText="height: calc(93vh - "+n+"px) !important;"}_=e})),U(),function(){var e=null,t=null,n={},a=window.location.search.split("?");if(1<a.length){var o=a[1].split("&");if(0<o.length)for(var i in o){var l=o[i].split("=");if(1<l.length){var r=l[0],s=l[1];n[r]=s}}}if(null!=n.aId&&(t=n.aId),t?function(e,t,n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var o="expires="+a.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}("aId",t,15):t=function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}("aId"),t&&(console.log("activityid:"+t),e=g.TRACKING_URL_PREFIX+t),e){var c=new XMLHttpRequest;c.open("POST",e,!0),c.send()}}(),{onRazorpayPaymentSuccess:function(e){for(var t={},n=e.getElementsByTagName("input"),a=0;a<n.length;a++){var o=n[a],i=o.getAttribute("name"),l=o.getAttribute("value");i&&l&&(t[i]=l)}document.getElementById("krazorpay-btn").innerHTML="",O(A.SubmitRazorpayPayment,t)},notifyChatWindow:O}}();